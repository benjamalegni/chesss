{"ast":null,"code":"import Chessboard from\"../Chessboard/Chessboard\";import\"./GameComps.css\";import LoginComponent from\"../../Login/LoginComponent\";import{useMemo,useState}from\"react\";import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function GameComps(){const[socket,setSocket]=useState(null);const[status,setStatus]=useState(\"offline\");const[roomId,setRoomId]=useState(null);const[myColor,setMyColor]=useState(null);const[joinCode,setJoinCode]=useState(\"\");const[showLogin,setShowLogin]=useState(false);function ensureSocket(){if(socket&&(status===\"waiting\"||status===\"playing\"))return socket;const s=io(\"http://localhost:8080\",{autoConnect:true});s.on('waiting',msg=>{setStatus(\"waiting\");setRoomId(msg.roomId);});s.on('start',msg=>{setRoomId(msg.roomId);setMyColor(msg.color===\"white\"?\"white\":\"black\");setStatus(\"playing\");});s.on('opponent_left',()=>{setStatus(\"offline\");setRoomId(null);setMyColor(null);try{s.close();}catch{}});s.on('room_created',msg=>{setStatus(\"waiting\");setRoomId(msg.roomId);});s.on('error',msg=>{alert((msg===null||msg===void 0?void 0:msg.error)||\"Error\");});s.on('disconnect',()=>{setStatus(\"offline\");setRoomId(null);setMyColor(null);setSocket(null);});setSocket(s);return s;}function createPrivateRoom(){const s=ensureSocket();s.emit('create_room');}function joinPrivateRoom(){const code=joinCode.trim();if(!code)return;const s=ensureSocket();s.emit('join_room',{roomId:code});}function disconnect(){try{socket===null||socket===void 0?void 0:socket.close();}catch{}setStatus(\"offline\");setRoomId(null);setMyColor(null);setSocket(null);}function copyRoomId(){if(!roomId)return;try{navigator.clipboard.writeText(roomId);}catch{}}const online=useMemo(()=>({socket,status,roomId:roomId!==null&&roomId!==void 0?roomId:undefined,myColor:myColor!==null&&myColor!==void 0?myColor:undefined}),[socket,status,roomId,myColor]);return/*#__PURE__*/_jsxs(\"div\",{id:\"component\",children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:10,right:10},children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowLogin(v=>!v),children:showLogin?'Cerrar':'Login'})}),showLogin?/*#__PURE__*/_jsx(\"div\",{style:{padding:16},children:/*#__PURE__*/_jsx(LoginComponent,{})}):/*#__PURE__*/_jsxs(\"div\",{className:\"center-stage\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"online-controls\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:createPrivateRoom,disabled:status===\"waiting\"||status===\"playing\",children:\"Crear sala\"}),/*#__PURE__*/_jsx(\"input\",{className:\"room-input\",placeholder:\"Ingresar c\\xF3digo de sala\",value:joinCode,onChange:e=>setJoinCode(e.target.value),disabled:status===\"waiting\"||status===\"playing\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:joinPrivateRoom,disabled:status===\"waiting\"||status===\"playing\"||!joinCode.trim(),children:\"Unirse a sala\"}),(status===\"waiting\"||status===\"playing\")&&/*#__PURE__*/_jsxs(\"span\",{className:\"hint status-badge\",children:[status==='waiting'?'Esperando oponente…':'En juego',\" \\xB7 Sala: \",roomId,/*#__PURE__*/_jsx(\"button\",{className:\"copy-btn\",onClick:copyRoomId,title:\"Copiar c\\xF3digo\",children:\"Copiar\"})]}),(status===\"waiting\"||status===\"playing\")&&/*#__PURE__*/_jsx(\"button\",{onClick:disconnect,children:\"Salir\"})]}),/*#__PURE__*/_jsx(\"div\",{className:`board-wrapper ${status!=='playing'?'is-blurred':''}`,children:/*#__PURE__*/_jsx(Chessboard,{online:online})})]})]});}export default GameComps;","map":{"version":3,"names":["Chessboard","LoginComponent","useMemo","useState","io","jsx","_jsx","jsxs","_jsxs","GameComps","socket","setSocket","status","setStatus","roomId","setRoomId","myColor","setMyColor","joinCode","setJoinCode","showLogin","setShowLogin","ensureSocket","s","autoConnect","on","msg","color","close","alert","error","createPrivateRoom","emit","joinPrivateRoom","code","trim","disconnect","copyRoomId","navigator","clipboard","writeText","online","undefined","id","children","style","position","top","right","onClick","v","padding","className","disabled","placeholder","value","onChange","e","target","title"],"sources":["/home/Outer/Documents/chesss/src/components/GameComps/GameComps.tsx"],"sourcesContent":["import Chessboard from \"../Chessboard/Chessboard\";\nimport \"./GameComps.css\"\nimport LoginComponent from \"../../Login/LoginComponent\";\nimport { useMemo, useState } from \"react\";\nimport { io, Socket } from 'socket.io-client';\n\nfunction GameComps(){\n    const [socket, setSocket] = useState<Socket | null>(null);\n    const [status, setStatus] = useState<\"offline\" | \"waiting\" | \"playing\">(\"offline\");\n    const [roomId, setRoomId] = useState<string | null>(null);\n    const [myColor, setMyColor] = useState<\"white\" | \"black\" | null>(null);\n    const [joinCode, setJoinCode] = useState<string>(\"\");\n    const [showLogin, setShowLogin] = useState<boolean>(false);\n\n    function ensureSocket(): Socket{\n        if(socket && (status === \"waiting\" || status === \"playing\")) return socket;\n        const s = io(\"http://localhost:8080\", { autoConnect: true });\n        s.on('waiting', (msg: any) => {\n            setStatus(\"waiting\");\n            setRoomId(msg.roomId);\n        });\n        s.on('start', (msg: any) => {\n            setRoomId(msg.roomId);\n            setMyColor(msg.color === \"white\" ? \"white\" : \"black\");\n            setStatus(\"playing\");\n        });\n        s.on('opponent_left', () => {\n            setStatus(\"offline\");\n            setRoomId(null);\n            setMyColor(null);\n            try{ s.close(); } catch {}\n        });\n        s.on('room_created', (msg: any) => {\n            setStatus(\"waiting\");\n            setRoomId(msg.roomId);\n        });\n        s.on('error', (msg: any) => {\n            alert(msg?.error || \"Error\");\n        });\n        s.on('disconnect', () => {\n            setStatus(\"offline\");\n            setRoomId(null);\n            setMyColor(null);\n            setSocket(null);\n        });\n        setSocket(s);\n        return s;\n    }\n\n    function createPrivateRoom(){\n        const s = ensureSocket();\n        s.emit('create_room');\n    }\n\n    function joinPrivateRoom(){\n        const code = joinCode.trim();\n        if(!code) return;\n        const s = ensureSocket();\n        s.emit('join_room', { roomId: code });\n    }\n\n    function disconnect(){\n        try{ socket?.close(); } catch {}\n        setStatus(\"offline\");\n        setRoomId(null);\n        setMyColor(null);\n        setSocket(null);\n    }\n\n    function copyRoomId(){\n        if(!roomId) return;\n        try{ navigator.clipboard.writeText(roomId); } catch {}\n    }\n\n    const online = useMemo(() => ({\n        socket,\n        status,\n        roomId: roomId ?? undefined,\n        myColor: myColor ?? undefined,\n    }), [socket, status, roomId, myColor]);\n\n    return <div id=\"component\">\n        <div style={{ position: 'absolute', top: 10, right: 10 }}>\n            <button onClick={()=> setShowLogin(v => !v)}>{showLogin ? 'Cerrar' : 'Login'}</button>\n        </div>\n        {showLogin ? (\n            <div style={{ padding: 16 }}>\n                <LoginComponent/>\n            </div>\n        ) : (\n            <div className=\"center-stage\">\n                <div id=\"online-controls\">\n                    <button className=\"btn btn-primary\" onClick={createPrivateRoom} disabled={status === \"waiting\" || status === \"playing\"}>Crear sala</button>\n                    <input\n                        className=\"room-input\"\n                        placeholder=\"Ingresar código de sala\"\n                        value={joinCode}\n                        onChange={(e)=> setJoinCode(e.target.value)}\n                        disabled={status === \"waiting\" || status === \"playing\"}\n                    />\n                    <button className=\"btn btn-secondary\" onClick={joinPrivateRoom} disabled={status === \"waiting\" || status === \"playing\" || !joinCode.trim()}>Unirse a sala</button>\n                    {(status === \"waiting\" || status === \"playing\") && (\n                        <span className=\"hint status-badge\">\n                            {status === 'waiting' ? 'Esperando oponente…' : 'En juego'} · Sala: {roomId}\n                            <button className=\"copy-btn\" onClick={copyRoomId} title=\"Copiar código\">Copiar</button>\n                        </span>\n                    )}\n                    {(status === \"waiting\" || status === \"playing\") && <button onClick={disconnect}>Salir</button>}\n                </div>\n                <div className={`board-wrapper ${status !== 'playing' ? 'is-blurred' : ''}`}>\n                    <Chessboard online={online}/>\n                </div>\n            </div>\n        )}\n    </div>\n}\n\nexport default GameComps;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}