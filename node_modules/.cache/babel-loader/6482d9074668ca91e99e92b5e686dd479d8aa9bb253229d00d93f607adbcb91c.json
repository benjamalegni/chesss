{"ast":null,"code":"import'./Chessboard.css';import Tile from'../Tile/Tile';import Referee from'../../referee/Referee';import{useEffect,useRef,useState}from'react';import{XAXIS,YAXIS,TeamType,PieceType,initialBoardState,GRIDSIZE,samePosition}from'../../Constants';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Chessboard(_ref){let{online}=_ref;const[activePiece,setActivePiece]=useState(null);const[grabPosition,setGrabPosition]=useState({x:-1,y:-1});const[pieces,setPieces]=useState(initialBoardState);const chessboardRef=useRef(null);const referee=new Referee();const[promotionPawn,setPromotionPawn]=useState();const modalRef=useRef(null);const[currentTurn,setCurrentTurn]=useState('white');const[lastMove,setLastMove]=useState(null);const[awaitingPromotion,setAwaitingPromotion]=useState(false);function getAllowedTeamForMe(){if(!online||online.status!=='playing'||!online.myColor){return null;}return online.myColor==='white'?TeamType.OUR:TeamType.OPPONENT;}function isMyTurn(){if(!online||online.status!=='playing'||!online.myColor){return true;// offline mode: always allowed\n}return online.myColor===currentTurn;}useEffect(()=>{if(online&&online.status==='playing'){setCurrentTurn('white');}},[online]);useEffect(()=>{const s=online===null||online===void 0?void 0:online.socket;if(!s)return;const onMove=msg=>{try{if(msg.type==='move'){// compatibility if server sends type wrapper\n}const from=msg.from;const to=msg.to;const promotion=msg.promotionType;setPieces(currentPieces=>{let updated=currentPieces;const movingPiece=updated.find(p=>samePosition(p.position,from));if(!movingPiece){return updated;}const isEnPassantMove=Referee.isEnPassantMove(from,to,movingPiece.type,movingPiece.team,updated);const pawnDirecion=movingPiece.team===TeamType.OUR?1:-1;if(isEnPassantMove){updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=false;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,{x:to.x,y:to.y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}else{updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=Math.abs(from.y-to.y)===2&&piece.type===PieceType.PAWN;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,to)){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}if(promotion!==undefined){const promoted=updated.find(p=>samePosition(p.position,to));if(promoted){promoted.type=promotion;const teamType=promoted.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(promotion){case PieceType.ROOK:image=\"rook\";break;case PieceType.BISHOP:image=\"bishop\";break;case PieceType.KNIGHT:image=\"knight\";break;case PieceType.QUEEN:image=\"queen\";break;}if(image){promoted.image=`${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;}}}return updated;});setCurrentTurn(prev=>prev==='white'?'black':'white');}catch(_e){// ignore\n}};s.on('move',onMove);return()=>{s.off('move',onMove);};},[online===null||online===void 0?void 0:online.socket,online===null||online===void 0?void 0:online.roomId]);function updateValidMoves(){setPieces(currentPieces=>{return currentPieces.map(p=>{p.possibleMoves=referee.getValidMoves(p,currentPieces);return p;});});}function performMove(target){const currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));if(!currentPiece)return;const{x,y}=target;const validMove=referee.isValidMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const isEnPassantMove=Referee.isEnPassantMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const pawnDirecion=currentPiece.team===TeamType.OUR?1:-1;if(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||currentPiece.team!==myTeam){return;}}if(isEnPassantMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=false;piece.position.x=x;piece.position.y=y;results.push(piece);}else if(!samePosition(piece.position,{x,y:y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket;(_online$socket=online.socket)===null||_online$socket===void 0?void 0:_online$socket.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}else if(validMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=Math.abs(grabPosition.y-y)===2&&piece.type===PieceType.PAWN;piece.position.x=x;piece.position.y=y;let promotionRow=piece.team===TeamType.OUR?7:0;if(y===promotionRow&&piece.type===PieceType.PAWN){var _modalRef$current;(_modalRef$current=modalRef.current)===null||_modalRef$current===void 0?void 0:_modalRef$current.classList.remove(\"hidden\");setPromotionPawn(piece);setAwaitingPromotion(true);}results.push(piece);}else if(!samePosition(piece.position,{x,y})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});if(!awaitingPromotion){if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket2;(_online$socket2=online.socket)===null||_online$socket2===void 0?void 0:_online$socket2.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}}}function pickTileFromCursor(clientX,clientY){const chessboard=chessboardRef.current;if(!chessboard)return{x:-1,y:-1};const rect=chessboard.getBoundingClientRect();const relX=clientX-rect.left;const relY=clientY-rect.top;const x=Math.floor(relX/GRIDSIZE);const y=Math.abs(Math.ceil((relY-rect.height)/GRIDSIZE));// invert axis\nreturn{x,y};}function grabPiece(e){updateValidMoves();const chessboard=chessboardRef.current;const element=e.target;if(element.classList.contains(\"chess-piece\")&&chessboard){const{x:grabX,y:grabY}=pickTileFromCursor(e.clientX,e.clientY);const pieceAtTile=pieces.find(p=>samePosition(p.position,{x:grabX,y:grabY}));// Online restrictions\nif(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||!pieceAtTile||pieceAtTile.team!==myTeam){return;// can't grab\n}}setGrabPosition({x:grabX,y:grabY});const x=e.clientX-GRIDSIZE/2;const y=e.clientY-GRIDSIZE/2;element.style.position='fixed';element.style.left=`${x}px`;element.style.top=`${y}px`;element.style.zIndex='1000';setActivePiece(element);}}function movePiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const x=e.clientX-GRIDSIZE/2;const y=e.clientY-GRIDSIZE/2;const rect=chessboard.getBoundingClientRect();const minX=rect.left;const minY=rect.top;const maxX=rect.right-GRIDSIZE;const maxY=rect.bottom-GRIDSIZE;activePiece.style.position='fixed';// x axis limits\nif(x<minX){activePiece.style.left=`${minX}px`;}else if(x>maxX){activePiece.style.left=`${maxX}px`;}else{activePiece.style.left=`${x}px`;}// y axis limits\nif(y<minY){activePiece.style.top=`${minY}px`;}else if(y>maxY){activePiece.style.top=`${maxY}px`;}else{activePiece.style.top=`${y}px`;}}}function dropPiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const target=pickTileFromCursor(e.clientX,e.clientY);performMove(target);//reset piece position\nactivePiece.style.position='relative';activePiece.style.removeProperty(\"top\");activePiece.style.removeProperty(\"left\");activePiece.style.removeProperty(\"z-index\");setActivePiece(null);}}function promotePawn(pieceType){var _modalRef$current2;if(promotionPawn===undefined){return;}const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.position)){piece.type=pieceType;const teamType=piece.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(pieceType){case PieceType.ROOK:{image=\"rook\";break;}case PieceType.BISHOP:{image=\"bishop\";break;}case PieceType.KNIGHT:{image=\"knight\";break;}case PieceType.QUEEN:{image=\"queen\";break;}}piece.image=`${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;}results.push(piece);return results;},[]);setPieces(updatedPieces);(_modalRef$current2=modalRef.current)===null||_modalRef$current2===void 0?void 0:_modalRef$current2.classList.add(\"hidden\");setAwaitingPromotion(false);if(online&&online.status==='playing'&&lastMove){var _online$socket3;(_online$socket3=online.socket)===null||_online$socket3===void 0?void 0:_online$socket3.emit('move',{roomId:online.roomId,from:lastMove.from,to:lastMove.to,promotionType:pieceType});setCurrentTurn(prev=>prev==='white'?'black':'white');}else if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}}function promotionTeamType(){return(promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.team)===TeamType.OUR?\"w\":\"b\";}let board=[];for(let y=YAXIS.length-1;y>=0;y--){for(let x=0;x<XAXIS.length;x++){// check whether the sum of numbers x,y is even to draw each tile\nconst isEven=(x+y+2)%2===0;let img=undefined;pieces.forEach(p=>{if(samePosition(p.position,{x:x,y:y})){img=p.image;}});let currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));let highlight=currentPiece!==null&&currentPiece!==void 0&&currentPiece.possibleMoves?currentPiece.possibleMoves.some(p=>samePosition(p,{x:x,y:y})):false;const targetHasPiece=pieces.some(p=>samePosition(p.position,{x,y}));const capture=highlight&&targetHasPiece;const handleClick=highlight?()=>performMove({x,y}):undefined;board.push(/*#__PURE__*/_jsx(Tile,{isEven:isEven,image:img,highlight:highlight,capture:capture,onClick:handleClick},`${x},${y}`));}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{id:\"pawn-promotion-modal\",className:\"hidden\",ref:modalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.ROOK),src:`${process.env.PUBLIC_URL}/assets/images/rook_${promotionTeamType()}.svg`,alt:\"promote rook\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.BISHOP),src:`${process.env.PUBLIC_URL}/assets/images/bishop_${promotionTeamType()}.svg`,alt:\"promote bishop\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.KNIGHT),src:`${process.env.PUBLIC_URL}/assets/images/knight_${promotionTeamType()}.svg`,alt:\"promote knight\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.QUEEN),src:`${process.env.PUBLIC_URL}/assets/images/queen_${promotionTeamType()}.svg`,alt:\"promote queen\"})]})}),/*#__PURE__*/_jsx(\"div\",{onMouseMove:e=>movePiece(e),onMouseDown:e=>grabPiece(e),onMouseUp:e=>dropPiece(e),id:\"chessboard\",ref:chessboardRef,children:board})]});}","map":{"version":3,"names":["Tile","Referee","useEffect","useRef","useState","XAXIS","YAXIS","TeamType","PieceType","initialBoardState","GRIDSIZE","samePosition","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chessboard","_ref","online","activePiece","setActivePiece","grabPosition","setGrabPosition","x","y","pieces","setPieces","chessboardRef","referee","promotionPawn","setPromotionPawn","modalRef","currentTurn","setCurrentTurn","lastMove","setLastMove","awaitingPromotion","setAwaitingPromotion","getAllowedTeamForMe","status","myColor","OUR","OPPONENT","isMyTurn","s","socket","onMove","msg","type","from","to","promotion","promotionType","currentPieces","updated","movingPiece","find","p","position","isEnPassantMove","team","pawnDirecion","reduce","results","piece","enPassant","push","PAWN","Math","abs","undefined","promoted","teamType","image","ROOK","BISHOP","KNIGHT","QUEEN","process","env","PUBLIC_URL","prev","_e","on","off","roomId","updateValidMoves","map","possibleMoves","getValidMoves","performMove","target","currentPiece","validMove","isValidMove","myTeam","updatedPieces","_online$socket","emit","promotionRow","_modalRef$current","current","classList","remove","_online$socket2","pickTileFromCursor","clientX","clientY","chessboard","rect","getBoundingClientRect","relX","left","relY","top","floor","ceil","height","grabPiece","e","element","contains","grabX","grabY","pieceAtTile","style","zIndex","movePiece","minX","minY","maxX","right","maxY","bottom","dropPiece","removeProperty","promotePawn","pieceType","_modalRef$current2","add","_online$socket3","promotionTeamType","board","length","isEven","img","forEach","highlight","some","targetHasPiece","capture","handleClick","onClick","children","id","className","ref","src","alt","onMouseMove","onMouseDown","onMouseUp"],"sources":["/home/Outer/Documents/chesss/src/components/Chessboard/Chessboard.tsx"],"sourcesContent":["import './Chessboard.css';\nimport Tile from '../Tile/Tile'\nimport Referee from '../../referee/Referee'\nimport { useEffect, useRef, useState } from 'react';\nimport { XAXIS, YAXIS, Piece, TeamType, PieceType, initialBoardState, Position, GRIDSIZE, samePosition } from '../../Constants';\nimport type { Socket } from 'socket.io-client';\n\ninterface OnlineProps{\n\tsocket: Socket | null;\n\tstatus: 'offline' | 'waiting' | 'playing';\n\troomId?: string;\n\tmyColor?: 'white' | 'black';\n}\n\nexport default function Chessboard({ online }: { online?: OnlineProps }){\nconst [activePiece, setActivePiece] = useState<HTMLElement | null>(null)\nconst [grabPosition, setGrabPosition] = useState<Position>({x:-1, y:-1});\nconst [pieces, setPieces] = useState<Piece[]>(initialBoardState);\nconst chessboardRef = useRef<HTMLDivElement>(null);\nconst referee = new Referee();\nconst [promotionPawn, setPromotionPawn] = useState<Piece>();\nconst modalRef = useRef<HTMLDivElement>(null);\nconst [currentTurn, setCurrentTurn] = useState<'white'|'black'>('white');\nconst [lastMove, setLastMove] = useState<{from: Position, to: Position} | null>(null);\nconst [awaitingPromotion, setAwaitingPromotion] = useState<boolean>(false);\n\nfunction getAllowedTeamForMe(): TeamType | null{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn null;\n\t}\n\treturn online.myColor === 'white' ? TeamType.OUR : TeamType.OPPONENT;\n}\n\nfunction isMyTurn(): boolean{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn true; // offline mode: always allowed\n\t}\n\treturn online.myColor === currentTurn;\n}\n\nuseEffect(()=>{\n\tif(online && online.status === 'playing'){\n\t\tsetCurrentTurn('white');\n\t}\n}, [online]);\n\nuseEffect(()=>{\n\tconst s = online?.socket;\n\tif(!s) return;\n\tconst onMove = (msg: any) => {\n\t\ttry{\n\t\t\tif(msg.type === 'move'){\n\t\t\t\t// compatibility if server sends type wrapper\n\t\t\t}\n\t\t\tconst from: Position = msg.from;\n\t\t\tconst to: Position = msg.to;\n\t\t\tconst promotion: PieceType | undefined = msg.promotionType;\n\t\t\tsetPieces((currentPieces)=>{\n\t\t\t\tlet updated = currentPieces;\n\t\t\t\tconst movingPiece = updated.find(p=> samePosition(p.position, from));\n\t\t\t\tif(!movingPiece){\n\t\t\t\t\treturn updated;\n\t\t\t\t}\n\t\t\t\tconst isEnPassantMove = Referee.isEnPassantMove(from, to, movingPiece.type, movingPiece.team, updated);\n\t\t\t\tconst pawnDirecion = movingPiece.team === TeamType.OUR?1:-1;\n\t\t\t\tif(isEnPassantMove){\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\tpiece.position.x=to.x;\n\t\t\t\t\t\t\tpiece.position.y=to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}else if(!samePosition(piece.position, {x: to.x, y: to.y - pawnDirecion})){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t} else {\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant = Math.abs(from.y - to.y)===2 && (piece.type===PieceType.PAWN);\n\t\t\t\t\t\t\tpiece.position.x = to.x;\n\t\t\t\t\t\t\tpiece.position.y = to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t} else if(!samePosition(piece.position, to)){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t}\n\t\t\t\tif(promotion !== undefined){\n\t\t\t\t\tconst promoted = updated.find(p=> samePosition(p.position, to));\n\t\t\t\t\tif(promoted){\n\t\t\t\t\t\tpromoted.type = promotion;\n\t\t\t\t\t\tconst teamType = (promoted.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\t\t\tlet image = \"\";\n\t\t\t\t\t\tswitch(promotion){\n\t\t\t\t\t\t\tcase PieceType.ROOK: image = \"rook\"; break;\n\t\t\t\t\t\t\tcase PieceType.BISHOP: image = \"bishop\"; break;\n\t\t\t\t\t\t\tcase PieceType.KNIGHT: image = \"knight\"; break;\n\t\t\t\t\t\t\tcase PieceType.QUEEN: image = \"queen\"; break;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(image){\n\t\t\t\t\t\t\tpromoted.image = `${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn updated;\n\t\t\t});\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}catch(_e){\n\t\t\t// ignore\n\t\t}\n\t};\n\ts.on('move', onMove);\n\treturn () => {\n\t\ts.off('move', onMove);\n\t};\n}, [online?.socket, online?.roomId]);\n\nfunction updateValidMoves(){\n\tsetPieces((currentPieces) => {\n\t\treturn currentPieces.map(p=>{\n\t\t\tp.possibleMoves = referee.getValidMoves(p, currentPieces);\n\t\t\treturn p;\n\n\t\t});\n\t});\n}\n\nfunction performMove(target: Position){\n\tconst currentPiece = pieces.find((p)=> samePosition(p.position, grabPosition));\n\tif(!currentPiece) return;\n\tconst { x, y } = target;\n\tconst validMove = referee.isValidMove(grabPosition, {x,y}, currentPiece.type,currentPiece.team, pieces);\n\tconst isEnPassantMove = Referee.isEnPassantMove(grabPosition, {x,y},currentPiece.type,currentPiece.team, pieces)\n\tconst pawnDirecion = currentPiece.team === TeamType.OUR?1:-1;\n\n\tif(online && online.status === 'playing'){\n\t\tconst myTeam = getAllowedTeamForMe();\n\t\tif(!isMyTurn() || myTeam === null || currentPiece.team !== myTeam){\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif(isEnPassantMove){\n\t\tconst updatedPieces = pieces.reduce((results, piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant=false;\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!samePosition(piece.position, {x, y: y-pawnDirecion})){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tif(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else {\n\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}else if(validMove){\n\t\tconst updatedPieces = pieces.reduce((results,piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant = Math.abs(grabPosition.y-y)===2 &&(piece.type===PieceType.PAWN)\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tlet promotionRow = piece.team === TeamType.OUR ? 7:0;\n\t\t\t\tif(y===promotionRow && piece.type === PieceType.PAWN){\n\t\t\t\t\tmodalRef.current?.classList.remove(\"hidden\")\n\t\t\t\t\tsetPromotionPawn(piece);\n\t\t\t\t\tsetAwaitingPromotion(true);\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!(samePosition(piece.position, {x,y}))){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tif(!(awaitingPromotion)){\n\t\t\tif(!online || online.status !== 'playing'){\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t} else {\n\t\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction pickTileFromCursor(clientX: number, clientY: number){\n\tconst chessboard = chessboardRef.current;\n\tif(!chessboard) return { x: -1, y: -1 };\n\tconst rect = chessboard.getBoundingClientRect();\n\tconst relX = clientX - rect.left;\n\tconst relY = clientY - rect.top;\n\tconst x = Math.floor(relX / GRIDSIZE);\n\tconst y = Math.abs(Math.ceil((relY - rect.height)/GRIDSIZE)); // invert axis\n\treturn { x, y };\n}\n\nfunction grabPiece(e: React.MouseEvent){\n\tupdateValidMoves();\n\n\tconst chessboard = chessboardRef.current;\n\tconst element = e.target as HTMLElement;\n\n\tif(element.classList.contains(\"chess-piece\") && chessboard){\n\t\tconst { x: grabX, y: grabY } = pickTileFromCursor(e.clientX, e.clientY);\n\t\tconst pieceAtTile = pieces.find(p => samePosition(p.position, {x: grabX, y: grabY}));\n\n\t\t// Online restrictions\n\t\tif(online && online.status === 'playing'){\n\t\t\tconst myTeam = getAllowedTeamForMe();\n\t\t\tif(!isMyTurn() || myTeam === null || !pieceAtTile || pieceAtTile.team !== myTeam){\n\t\t\t\treturn; // can't grab\n\t\t\t}\n\t\t}\n\n\t\tsetGrabPosition({x:grabX, y:grabY})\n\n\t\tconst x = e.clientX - GRIDSIZE/2;\n\t\tconst y = e.clientY - GRIDSIZE/2;\n\t\telement.style.position = 'fixed';\n\t\telement.style.left = `${x}px`;\n\t\telement.style.top = `${y}px`;\n\t\telement.style.zIndex = '1000';\n\n\t\tsetActivePiece(element);\n\t}\n}\n\nfunction movePiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst x = e.clientX - GRIDSIZE/2;\n\t\tconst y = e.clientY - GRIDSIZE/2;\n\n\t\tconst rect = chessboard.getBoundingClientRect();\n\t\tconst minX = rect.left;\n\t\tconst minY = rect.top;\n\t\tconst maxX = rect.right - GRIDSIZE;\n\t\tconst maxY = rect.bottom - GRIDSIZE;\n\n\t\tactivePiece.style.position = 'fixed';\n\n\t\t// x axis limits\n\t\tif(x < minX){\n\t\t\tactivePiece.style.left = `${minX}px`;\n\t\t} else if(x > maxX){\n\t\t\tactivePiece.style.left = `${maxX}px`;\n\t\t} else{\n\t\t\tactivePiece.style.left = `${x}px`;\n\t\t}\n\n\t\t// y axis limits\n\t\tif(y < minY){\n\t\t\tactivePiece.style.top = `${minY}px`;\n\t\t} else if(y > maxY){\n\t\t\tactivePiece.style.top = `${maxY}px`;\n\t\t} else{\n\t\t\tactivePiece.style.top = `${y}px`;\n\t\t}\n\t\t\n\t}\n}\n\nfunction dropPiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst target = pickTileFromCursor(e.clientX, e.clientY);\n\t\tperformMove(target);\n\t\t//reset piece position\n\t\tactivePiece.style.position= 'relative';\n\t\tactivePiece.style.removeProperty(\"top\");\n\t\tactivePiece.style.removeProperty(\"left\");\n\t\tactivePiece.style.removeProperty(\"z-index\");\n\t\tsetActivePiece(null);\n\t}\n}\n\n\tfunction promotePawn(pieceType: PieceType){\n\t\tif(promotionPawn===undefined){\n\t\t\treturn;\n\t\t}\n\t\tconst updatedPieces = pieces.reduce((results, piece) =>{\n\n\t\t\tif(samePosition(piece.position, promotionPawn?.position)){\n\t\t\t\tpiece.type = pieceType;\n\t\t\t\tconst teamType = (piece.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\tlet image = \"\";\n\t\t\t\tswitch(pieceType){\n\t\t\t\t\tcase PieceType.ROOK:{\n\t\t\t\t\t\timage = \"rook\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.BISHOP:{\n\t\t\t\t\t\timage = \"bishop\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.KNIGHT:{\n\t\t\t\t\t\timage = \"knight\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.QUEEN:{\n\t\t\t\t\t\timage = \"queen\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpiece.image = `${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;\n\t\t\t}\n\n\t\t\tresults.push(piece);\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tmodalRef.current?.classList.add(\"hidden\");\n\t\tsetAwaitingPromotion(false);\n\t\tif(online && online.status === 'playing' && lastMove){\n\t\t\tonline.socket?.emit('move', {\n\t\t\t\troomId: online.roomId,\n\t\t\t\tfrom: lastMove.from,\n\t\t\t\tto: lastMove.to,\n\t\t\t\tpromotionType: pieceType\n\t\t\t});\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else if(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}\n\n\n\tfunction promotionTeamType(){\n\t\treturn (promotionPawn?.team === TeamType.OUR)?\"w\":\"b\";\n\t}\n\n\tlet board = [];\n\n\tfor(let y= YAXIS.length-1;y>=0;y--){\n\t\tfor(let x=0;x<XAXIS.length;x++){\n\n\t\t\t// check whether the sum of numbers x,y is even to draw each tile\n\t\t\tconst isEven = (x+y+2)%2===0;\n\t\t\tlet img = undefined;\n\n\t\t\tpieces.forEach(p=> {\n\t\t\t\tif(samePosition(p.position, {x:x, y:y})){\n\t\t\t\t\timg=p.image\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tlet currentPiece = pieces.find(p=> samePosition(p.position,grabPosition));\n\t\t\tlet highlight = (currentPiece?.possibleMoves) ? currentPiece.possibleMoves.some(p=> samePosition(p, {x:x , y:y})): false;\n\t\t\tconst targetHasPiece = pieces.some(p => samePosition(p.position, {x, y}));\n\t\t\tconst capture = highlight && targetHasPiece;\n\t\t\tconst handleClick = highlight ? () => performMove({ x, y }) : undefined;\n\t\t\t\n\t\t\tboard.push(\n\t\t\t\t\t<Tile key={`${x},${y}`} isEven={isEven} image={img} highlight={highlight} capture={capture} onClick={handleClick}/> \n\t\t\t)\n\t\t}\n\t}       \n\n\n\treturn(\n\t\t<>\n\t\t<div id=\"pawn-promotion-modal\" className=\"hidden\" ref={modalRef}>\n\t\t\t<div className=\"modal-body\">\n\n\t\t\t<img onClick={()=> promotePawn(PieceType.ROOK)} src={`${process.env.PUBLIC_URL}/assets/images/rook_${promotionTeamType()}.svg`} alt=\"promote rook\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.BISHOP)} src={`${process.env.PUBLIC_URL}/assets/images/bishop_${promotionTeamType()}.svg`} alt=\"promote bishop\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.KNIGHT)} src={`${process.env.PUBLIC_URL}/assets/images/knight_${promotionTeamType()}.svg`} alt=\"promote knight\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.QUEEN)} src={`${process.env.PUBLIC_URL}/assets/images/queen_${promotionTeamType()}.svg`} alt=\"promote queen\"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div \n\t\t\tonMouseMove={(e)=>movePiece(e)} \n\t\t\tonMouseDown={e=> grabPiece(e)} \n\t\t\tonMouseUp={(e)=> dropPiece(e)}\n\t\t\tid=\"chessboard\"\n\t\t\tref={chessboardRef}>\n\t\t\t\t{board}\n\t\t</div>\n\t\t</>\n\t)\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}