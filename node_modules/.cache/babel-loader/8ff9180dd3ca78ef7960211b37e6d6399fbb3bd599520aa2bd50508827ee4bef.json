{"ast":null,"code":"import'./Chessboard.css';import Tile from'../Tile/Tile';import Referee from'../../referee/Referee';import{useEffect,useRef,useState}from'react';import{XAXIS,YAXIS,TeamType,PieceType,initialBoardState,GRIDSIZE,samePosition}from'../../Constants';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Chessboard(_ref){let{online,timeLimitSeconds}=_ref;const[activePiece,setActivePiece]=useState(null);const[grabPosition,setGrabPosition]=useState({x:-1,y:-1});const[pieces,setPieces]=useState(initialBoardState);const chessboardRef=useRef(null);const referee=new Referee();const[promotionPawn,setPromotionPawn]=useState();const modalRef=useRef(null);const[currentTurn,setCurrentTurn]=useState('white');const[lastMove,setLastMove]=useState(null);const[awaitingPromotion,setAwaitingPromotion]=useState(false);// Clock state\nconst[whiteTimeLeft,setWhiteTimeLeft]=useState(null);const[blackTimeLeft,setBlackTimeLeft]=useState(null);const[clockStarted,setClockStarted]=useState(false);// Responsive tile size in px, derived from board size\nconst[tileSize,setTileSize]=useState(GRIDSIZE);useEffect(()=>{function updateTileSize(){const el=chessboardRef.current;if(!el)return;const rect=el.getBoundingClientRect();const size=Math.floor(rect.width/8);if(size>0)setTileSize(size);}updateTileSize();window.addEventListener('resize',updateTileSize);return()=>window.removeEventListener('resize',updateTileSize);},[]);function getAllowedTeamForMe(){if(!online||online.status!=='playing'||!online.myColor){return null;}return online.myColor==='white'?TeamType.OUR:TeamType.OPPONENT;}function isMyTurn(){if(!online||online.status!=='playing'||!online.myColor){return true;// offline mode: always allowed\n}return online.myColor===currentTurn;}// Initialize turn and timers when a game starts or time limit provided\nuseEffect(()=>{if((online===null||online===void 0?void 0:online.status)==='playing'){setCurrentTurn('white');if(whiteTimeLeft===null||blackTimeLeft===null){const limit=typeof timeLimitSeconds==='number'&&timeLimitSeconds>0?timeLimitSeconds:300;setWhiteTimeLeft(limit);setBlackTimeLeft(limit);}setClockStarted(true);}else{setClockStarted(false);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[online===null||online===void 0?void 0:online.status,timeLimitSeconds]);// Opponent move listener\nuseEffect(()=>{const s=online===null||online===void 0?void 0:online.socket;if(!s)return;const onMove=msg=>{try{setClockStarted(true);if(msg.type==='move'){// compatibility if server sends type wrapper\n}const from=msg.from;const to=msg.to;const promotion=msg.promotionType;setPieces(currentPieces=>{let updated=currentPieces;const movingPiece=updated.find(p=>samePosition(p.position,from));if(!movingPiece){return updated;}const isEnPassantMove=Referee.isEnPassantMove(from,to,movingPiece.type,movingPiece.team,updated);const pawnDirecion=movingPiece.team===TeamType.OUR?1:-1;if(isEnPassantMove){updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=false;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,{x:to.x,y:to.y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}else{updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=Math.abs(from.y-to.y)===2&&piece.type===PieceType.PAWN;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,to)){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}if(promotion!==undefined){const promoted=updated.find(p=>samePosition(p.position,to));if(promoted){promoted.type=promotion;const teamType=promoted.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(promotion){case PieceType.ROOK:image=\"rook\";break;case PieceType.BISHOP:image=\"bishop\";break;case PieceType.KNIGHT:image=\"knight\";break;case PieceType.QUEEN:image=\"queen\";break;}if(image){promoted.image=`assets/images/${image}_${teamType}.svg`;}}}return updated;});setCurrentTurn(prev=>prev==='white'?'black':'white');}catch(_e){// ignore\n}};s.on('move',onMove);return()=>{s.off('move',onMove);};},[online]);function updateValidMoves(){setPieces(currentPieces=>{return currentPieces.map(p=>{p.possibleMoves=referee.getValidMoves(p,currentPieces);return p;});});}// Clock ticking effect\nuseEffect(()=>{if(whiteTimeLeft===null||blackTimeLeft===null)return;if(!online||online.status!=='playing')return;if(awaitingPromotion)return;if(!clockStarted)return;const interval=setInterval(()=>{if(currentTurn==='white'){setWhiteTimeLeft(prev=>{if(prev===null)return prev;const next=Math.max(0,prev-1);return next;});}else{setBlackTimeLeft(prev=>{if(prev===null)return prev;const next=Math.max(0,prev-1);return next;});}},1000);return()=>clearInterval(interval);},[online,online===null||online===void 0?void 0:online.status,currentTurn,whiteTimeLeft,blackTimeLeft,awaitingPromotion,clockStarted]);// Ensure the clock starts after the very first move (local or remote)\nuseEffect(()=>{if(lastMove&&typeof timeLimitSeconds==='number'&&timeLimitSeconds>0){setClockStarted(true);}},[lastMove,timeLimitSeconds]);function performMove(target){const currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));if(!currentPiece)return;const{x,y}=target;const validMove=referee.isValidMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const isEnPassantMove=Referee.isEnPassantMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const pawnDirecion=currentPiece.team===TeamType.OUR?1:-1;if(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||currentPiece.team!==myTeam){return;}// Optional: stop moves if your time is up\nif(typeof timeLimitSeconds==='number'&&timeLimitSeconds>0){if(currentTurn==='white'&&whiteTimeLeft===0||currentTurn==='black'&&blackTimeLeft===0){return;}}}if(isEnPassantMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=false;piece.position.x=x;piece.position.y=y;results.push(piece);}else if(!samePosition(piece.position,{x,y:y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});setClockStarted(true);if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket;(_online$socket=online.socket)===null||_online$socket===void 0?void 0:_online$socket.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}else if(validMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=Math.abs(grabPosition.y-y)===2&&piece.type===PieceType.PAWN;piece.position.x=x;piece.position.y=y;let promotionRow=piece.team===TeamType.OUR?7:0;if(y===promotionRow&&piece.type===PieceType.PAWN){var _modalRef$current;(_modalRef$current=modalRef.current)===null||_modalRef$current===void 0?void 0:_modalRef$current.classList.remove(\"hidden\");setPromotionPawn(piece);setAwaitingPromotion(true);}results.push(piece);}else if(!samePosition(piece.position,{x,y})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});if(!awaitingPromotion){setClockStarted(true);if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket2;(_online$socket2=online.socket)===null||_online$socket2===void 0?void 0:_online$socket2.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}}}function pickTileFromCursor(clientX,clientY){const chessboard=chessboardRef.current;if(!chessboard)return{x:-1,y:-1};const rect=chessboard.getBoundingClientRect();const relX=clientX-rect.left;const relY=clientY-rect.top;const x=Math.floor(relX/tileSize);const y=Math.abs(Math.ceil((relY-rect.height)/tileSize));// invert axis\nreturn{x,y};}function grabPiece(e){updateValidMoves();const chessboard=chessboardRef.current;const element=e.target;if(element.classList.contains(\"chess-piece\")&&chessboard){const{x:grabX,y:grabY}=pickTileFromCursor(e.clientX,e.clientY);const pieceAtTile=pieces.find(p=>samePosition(p.position,{x:grabX,y:grabY}));// Online restrictions\nif(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||!pieceAtTile||pieceAtTile.team!==myTeam){return;// can't grab\n}}setGrabPosition({x:grabX,y:grabY});const x=e.clientX-tileSize/2;const y=e.clientY-tileSize/2;element.style.position='fixed';element.style.left=`${x}px`;element.style.top=`${y}px`;element.style.zIndex='1000';setActivePiece(element);}}function movePiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const x=e.clientX-tileSize/2;const y=e.clientY-tileSize/2;const rect=chessboard.getBoundingClientRect();const minX=rect.left;const minY=rect.top;const maxX=rect.right-tileSize;const maxY=rect.bottom-tileSize;activePiece.style.position='fixed';// x axis limits\nif(x<minX){activePiece.style.left=`${minX}px`;}else if(x>maxX){activePiece.style.left=`${maxX}px`;}else{activePiece.style.left=`${x}px`;}// y axis limits\nif(y<minY){activePiece.style.top=`${minY}px`;}else if(y>maxY){activePiece.style.top=`${maxY}px`;}else{activePiece.style.top=`${y}px`;}}}function dropPiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const target=pickTileFromCursor(e.clientX,e.clientY);performMove(target);//reset piece position\nactivePiece.style.position='relative';activePiece.style.removeProperty(\"top\");activePiece.style.removeProperty(\"left\");activePiece.style.removeProperty(\"z-index\");setActivePiece(null);}}function promotePawn(pieceType){var _modalRef$current2;if(promotionPawn===undefined){return;}const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.position)){piece.type=pieceType;const teamType=piece.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(pieceType){case PieceType.ROOK:{image=\"rook\";break;}case PieceType.BISHOP:{image=\"bishop\";break;}case PieceType.KNIGHT:{image=\"knight\";break;}case PieceType.QUEEN:{image=\"queen\";break;}}piece.image=`assets/images/${image}_${teamType}.svg`;}results.push(piece);return results;},[]);setPieces(updatedPieces);(_modalRef$current2=modalRef.current)===null||_modalRef$current2===void 0?void 0:_modalRef$current2.classList.add(\"hidden\");setAwaitingPromotion(false);if(online&&online.status==='playing'&&lastMove){var _online$socket3;(_online$socket3=online.socket)===null||_online$socket3===void 0?void 0:_online$socket3.emit('move',{roomId:online.roomId,from:lastMove.from,to:lastMove.to,promotionType:pieceType});setClockStarted(true);setCurrentTurn(prev=>prev==='white'?'black':'white');}else if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}}function promotionTeamType(){return(promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.team)===TeamType.OUR?\"w\":\"b\";}function formatTime(totalSeconds){if(totalSeconds===null)return'--:--';const m=Math.floor(totalSeconds/60);const s=totalSeconds%60;return`${m}:${s.toString().padStart(2,'0')}`;}let board=[];for(let y=YAXIS.length-1;y>=0;y--){for(let x=0;x<XAXIS.length;x++){// check whether the sum of numbers x,y is even to draw each tile\nconst isEven=(x+y+2)%2===0;let img=undefined;pieces.forEach(p=>{if(samePosition(p.position,{x:x,y:y})){img=p.image;}});let currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));let highlight=currentPiece!==null&&currentPiece!==void 0&&currentPiece.possibleMoves?currentPiece.possibleMoves.some(p=>samePosition(p,{x:x,y:y})):false;const targetHasPiece=pieces.some(p=>samePosition(p.position,{x,y}));const capture=highlight&&targetHasPiece;const handleClick=highlight?()=>performMove({x,y}):undefined;board.push(/*#__PURE__*/_jsx(Tile,{isEven:isEven,image:img,highlight:highlight,capture:capture,onClick:handleClick},`${x},${y}`));}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{id:\"pawn-promotion-modal\",className:\"hidden\",ref:modalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.ROOK),src:`assets/images/rook_${promotionTeamType()}.svg`,alt:\"promote rook\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.BISHOP),src:`assets/images/bishop_${promotionTeamType()}.svg`,alt:\"promote bishop\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.KNIGHT),src:`assets/images/knight_${promotionTeamType()}.svg`,alt:\"promote knight\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.QUEEN),src:`assets/images/queen_${promotionTeamType()}.svg`,alt:\"promote queen\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-layout\",children:[(online===null||online===void 0?void 0:online.status)==='playing'&&/*#__PURE__*/_jsxs(\"div\",{className:\"timer-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:`timer-block ${currentTurn==='black'?'active':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"timer-label\",children:\"Black\"}),/*#__PURE__*/_jsx(\"div\",{className:\"timer-value\",children:formatTime(blackTimeLeft)})]}),/*#__PURE__*/_jsxs(\"div\",{className:`timer-block ${currentTurn==='white'?'active':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"timer-label\",children:\"White\"}),/*#__PURE__*/_jsx(\"div\",{className:\"timer-value\",children:formatTime(whiteTimeLeft)})]})]}),/*#__PURE__*/_jsx(\"div\",{onMouseMove:e=>movePiece(e),onMouseDown:e=>grabPiece(e),onMouseUp:e=>dropPiece(e),id:\"chessboard\",ref:chessboardRef,children:board})]})]});}","map":{"version":3,"names":["Tile","Referee","useEffect","useRef","useState","XAXIS","YAXIS","TeamType","PieceType","initialBoardState","GRIDSIZE","samePosition","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chessboard","_ref","online","timeLimitSeconds","activePiece","setActivePiece","grabPosition","setGrabPosition","x","y","pieces","setPieces","chessboardRef","referee","promotionPawn","setPromotionPawn","modalRef","currentTurn","setCurrentTurn","lastMove","setLastMove","awaitingPromotion","setAwaitingPromotion","whiteTimeLeft","setWhiteTimeLeft","blackTimeLeft","setBlackTimeLeft","clockStarted","setClockStarted","tileSize","setTileSize","updateTileSize","el","current","rect","getBoundingClientRect","size","Math","floor","width","window","addEventListener","removeEventListener","getAllowedTeamForMe","status","myColor","OUR","OPPONENT","isMyTurn","limit","s","socket","onMove","msg","type","from","to","promotion","promotionType","currentPieces","updated","movingPiece","find","p","position","isEnPassantMove","team","pawnDirecion","reduce","results","piece","enPassant","push","PAWN","abs","undefined","promoted","teamType","image","ROOK","BISHOP","KNIGHT","QUEEN","prev","_e","on","off","updateValidMoves","map","possibleMoves","getValidMoves","interval","setInterval","next","max","clearInterval","performMove","target","currentPiece","validMove","isValidMove","myTeam","updatedPieces","_online$socket","emit","roomId","promotionRow","_modalRef$current","classList","remove","_online$socket2","pickTileFromCursor","clientX","clientY","chessboard","relX","left","relY","top","ceil","height","grabPiece","e","element","contains","grabX","grabY","pieceAtTile","style","zIndex","movePiece","minX","minY","maxX","right","maxY","bottom","dropPiece","removeProperty","promotePawn","pieceType","_modalRef$current2","add","_online$socket3","promotionTeamType","formatTime","totalSeconds","m","toString","padStart","board","length","isEven","img","forEach","highlight","some","targetHasPiece","capture","handleClick","onClick","children","id","className","ref","src","alt","onMouseMove","onMouseDown","onMouseUp"],"sources":["/home/Outer/Documents/chesss/src/components/Chessboard/Chessboard.tsx"],"sourcesContent":["import './Chessboard.css';\nimport Tile from '../Tile/Tile'\nimport Referee from '../../referee/Referee'\nimport { useEffect, useRef, useState } from 'react';\nimport { XAXIS, YAXIS, Piece, TeamType, PieceType, initialBoardState, Position, GRIDSIZE, samePosition } from '../../Constants';\nimport type { Socket } from 'socket.io-client';\n\ninterface OnlineProps{\n\tsocket: Socket | null;\n\tstatus: 'offline' | 'waiting' | 'playing';\n\troomId?: string;\n\tmyColor?: 'white' | 'black';\n}\n\nexport default function Chessboard({ online, timeLimitSeconds }: { online?: OnlineProps, timeLimitSeconds?: number }){\nconst [activePiece, setActivePiece] = useState<HTMLElement | null>(null)\nconst [grabPosition, setGrabPosition] = useState<Position>({x:-1, y:-1});\nconst [pieces, setPieces] = useState<Piece[]>(initialBoardState);\nconst chessboardRef = useRef<HTMLDivElement>(null);\nconst referee = new Referee();\nconst [promotionPawn, setPromotionPawn] = useState<Piece>();\nconst modalRef = useRef<HTMLDivElement>(null);\nconst [currentTurn, setCurrentTurn] = useState<'white'|'black'>('white');\nconst [lastMove, setLastMove] = useState<{from: Position, to: Position} | null>(null);\nconst [awaitingPromotion, setAwaitingPromotion] = useState<boolean>(false);\n\n// Clock state\nconst [whiteTimeLeft, setWhiteTimeLeft] = useState<number | null>(null);\nconst [blackTimeLeft, setBlackTimeLeft] = useState<number | null>(null);\nconst [clockStarted, setClockStarted] = useState<boolean>(false);\n\n// Responsive tile size in px, derived from board size\nconst [tileSize, setTileSize] = useState<number>(GRIDSIZE);\nuseEffect(()=>{\n\tfunction updateTileSize(){\n\t\tconst el = chessboardRef.current;\n\t\tif(!el) return;\n\t\tconst rect = el.getBoundingClientRect();\n\t\tconst size = Math.floor(rect.width / 8);\n\t\tif(size > 0) setTileSize(size);\n\t}\n\tupdateTileSize();\n\twindow.addEventListener('resize', updateTileSize);\n\treturn ()=> window.removeEventListener('resize', updateTileSize);\n}, []);\n\nfunction getAllowedTeamForMe(): TeamType | null{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn null;\n\t}\n\treturn online.myColor === 'white' ? TeamType.OUR : TeamType.OPPONENT;\n}\n\nfunction isMyTurn(): boolean{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn true; // offline mode: always allowed\n\t}\n\treturn online.myColor === currentTurn;\n}\n\n// Initialize turn and timers when a game starts or time limit provided\nuseEffect(()=>{\n\tif(online?.status === 'playing'){\n\t\tsetCurrentTurn('white');\n\t\tif(whiteTimeLeft === null || blackTimeLeft === null){\n\t\t\tconst limit = (typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0) ? timeLimitSeconds : 300;\n\t\t\tsetWhiteTimeLeft(limit);\n\t\t\tsetBlackTimeLeft(limit);\n\t\t}\n\t\tsetClockStarted(true);\n\t} else {\n\t\tsetClockStarted(false);\n\t}\n// eslint-disable-next-line react-hooks/exhaustive-deps\n}, [online?.status, timeLimitSeconds]);\n\n// Opponent move listener\nuseEffect(()=>{\n\tconst s = online?.socket;\n\tif(!s) return;\n\tconst onMove = (msg: any) => {\n\t\ttry{\n\t\t\tsetClockStarted(true);\n\t\t\tif(msg.type === 'move'){\n\t\t\t\t// compatibility if server sends type wrapper\n\t\t\t}\n\t\t\tconst from: Position = msg.from;\n\t\t\tconst to: Position = msg.to;\n\t\t\tconst promotion: PieceType | undefined = msg.promotionType;\n\t\t\tsetPieces((currentPieces)=>{\n\t\t\t\tlet updated = currentPieces;\n\t\t\t\tconst movingPiece = updated.find(p=> samePosition(p.position, from));\n\t\t\t\tif(!movingPiece){\n\t\t\t\t\treturn updated;\n\t\t\t\t}\n\t\t\t\tconst isEnPassantMove = Referee.isEnPassantMove(from, to, movingPiece.type, movingPiece.team, updated);\n\t\t\t\tconst pawnDirecion = movingPiece.team === TeamType.OUR?1:-1;\n\t\t\t\tif(isEnPassantMove){\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\tpiece.position.x=to.x;\n\t\t\t\t\t\t\tpiece.position.y=to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}else if(!samePosition(piece.position, {x: to.x, y: to.y - pawnDirecion})){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t} else {\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant = Math.abs(from.y - to.y)===2 && (piece.type===PieceType.PAWN);\n\t\t\t\t\t\t\tpiece.position.x = to.x;\n\t\t\t\t\t\t\tpiece.position.y = to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t} else if(!samePosition(piece.position, to)){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t}\n\t\t\t\tif(promotion !== undefined){\n\t\t\t\t\tconst promoted = updated.find(p=> samePosition(p.position, to));\n\t\t\t\t\tif(promoted){\n\t\t\t\t\t\tpromoted.type = promotion;\n\t\t\t\t\t\tconst teamType = (promoted.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\t\t\tlet image = \"\";\n\t\t\t\t\t\tswitch(promotion){\n\t\t\t\t\t\t\tcase PieceType.ROOK: image = \"rook\"; break;\n\t\t\t\t\t\t\tcase PieceType.BISHOP: image = \"bishop\"; break;\n\t\t\t\t\t\t\tcase PieceType.KNIGHT: image = \"knight\"; break;\n\t\t\t\t\t\t\tcase PieceType.QUEEN: image = \"queen\"; break;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(image){\n\t\t\t\t\t\t\tpromoted.image = `assets/images/${image}_${teamType}.svg`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn updated;\n\t\t\t});\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}catch(_e){\n\t\t\t// ignore\n\t\t}\n\t};\n\ts.on('move', onMove);\n\treturn () => {\n\t\ts.off('move', onMove);\n\t};\n}, [online]);\n\nfunction updateValidMoves(){\n\tsetPieces((currentPieces) => {\n\t\treturn currentPieces.map(p=>{\n\t\t\tp.possibleMoves = referee.getValidMoves(p, currentPieces);\n\t\t\treturn p;\n\n\t\t});\n\t});\n}\n\n// Clock ticking effect\nuseEffect(()=>{\n\tif(whiteTimeLeft === null || blackTimeLeft === null) return;\n\tif(!online || online.status !== 'playing') return;\n\tif(awaitingPromotion) return;\n\tif(!clockStarted) return;\n\tconst interval = setInterval(()=>{\n\t\tif(currentTurn === 'white'){\n\t\t\tsetWhiteTimeLeft(prev => {\n\t\t\t\tif(prev === null) return prev;\n\t\t\t\tconst next = Math.max(0, prev - 1);\n\t\t\t\treturn next;\n\t\t\t});\n\t\t} else {\n\t\t\tsetBlackTimeLeft(prev => {\n\t\t\t\tif(prev === null) return prev;\n\t\t\t\tconst next = Math.max(0, prev - 1);\n\t\t\t\treturn next;\n\t\t\t});\n\t\t}\n\t}, 1000);\n\treturn () => clearInterval(interval);\n}, [online, online?.status, currentTurn, whiteTimeLeft, blackTimeLeft, awaitingPromotion, clockStarted]);\n\n// Ensure the clock starts after the very first move (local or remote)\nuseEffect(()=>{\n\tif(lastMove && typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0){\n\t\tsetClockStarted(true);\n\t}\n}, [lastMove, timeLimitSeconds]);\n\nfunction performMove(target: Position){\n\tconst currentPiece = pieces.find((p)=> samePosition(p.position, grabPosition));\n\tif(!currentPiece) return;\n\tconst { x, y } = target;\n\tconst validMove = referee.isValidMove(grabPosition, {x,y}, currentPiece.type,currentPiece.team, pieces);\n\tconst isEnPassantMove = Referee.isEnPassantMove(grabPosition, {x,y},currentPiece.type,currentPiece.team, pieces)\n\tconst pawnDirecion = currentPiece.team === TeamType.OUR?1:-1;\n\n\tif(online && online.status === 'playing'){\n\t\tconst myTeam = getAllowedTeamForMe();\n\t\tif(!isMyTurn() || myTeam === null || currentPiece.team !== myTeam){\n\t\t\treturn;\n\t\t}\n\t\t// Optional: stop moves if your time is up\n\t\tif(typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0){\n\t\t\tif((currentTurn === 'white' && whiteTimeLeft === 0) || (currentTurn === 'black' && blackTimeLeft === 0)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tif(isEnPassantMove){\n\t\tconst updatedPieces = pieces.reduce((results, piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant=false;\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!samePosition(piece.position, {x, y: y-pawnDirecion})){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tsetClockStarted(true);\n\t\tif(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else {\n\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}else if(validMove){\n\t\tconst updatedPieces = pieces.reduce((results,piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant = Math.abs(grabPosition.y-y)===2 &&(piece.type===PieceType.PAWN)\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tlet promotionRow = piece.team === TeamType.OUR ? 7:0;\n\t\t\t\tif(y===promotionRow && piece.type === PieceType.PAWN){\n\t\t\t\t\tmodalRef.current?.classList.remove(\"hidden\")\n\t\t\t\t\tsetPromotionPawn(piece);\n\t\t\t\t\tsetAwaitingPromotion(true);\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!(samePosition(piece.position, {x,y}))){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tif(!(awaitingPromotion)){\n\t\t\tsetClockStarted(true);\n\t\t\tif(!online || online.status !== 'playing'){\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t} else {\n\t\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction pickTileFromCursor(clientX: number, clientY: number){\n\tconst chessboard = chessboardRef.current;\n\tif(!chessboard) return { x: -1, y: -1 };\n\tconst rect = chessboard.getBoundingClientRect();\n\tconst relX = clientX - rect.left;\n\tconst relY = clientY - rect.top;\n\tconst x = Math.floor(relX / tileSize);\n\tconst y = Math.abs(Math.ceil((relY - rect.height)/tileSize)); // invert axis\n\treturn { x, y };\n}\n\nfunction grabPiece(e: React.MouseEvent){\n\tupdateValidMoves();\n\n\tconst chessboard = chessboardRef.current;\n\tconst element = e.target as HTMLElement;\n\n\tif(element.classList.contains(\"chess-piece\") && chessboard){\n\t\tconst { x: grabX, y: grabY } = pickTileFromCursor(e.clientX, e.clientY);\n\t\tconst pieceAtTile = pieces.find(p => samePosition(p.position, {x: grabX, y: grabY}));\n\n\t\t// Online restrictions\n\t\tif(online && online.status === 'playing'){\n\t\t\tconst myTeam = getAllowedTeamForMe();\n\t\t\tif(!isMyTurn() || myTeam === null || !pieceAtTile || pieceAtTile.team !== myTeam){\n\t\t\t\treturn; // can't grab\n\t\t\t}\n\t\t}\n\n\t\tsetGrabPosition({x:grabX, y:grabY})\n\n\t\tconst x = e.clientX - tileSize/2;\n\t\tconst y = e.clientY - tileSize/2;\n\t\telement.style.position = 'fixed';\n\t\telement.style.left = `${x}px`;\n\t\telement.style.top = `${y}px`;\n\t\telement.style.zIndex = '1000';\n\n\t\tsetActivePiece(element);\n\t}\n}\n\nfunction movePiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst x = e.clientX - tileSize/2;\n\t\tconst y = e.clientY - tileSize/2;\n\n\t\tconst rect = chessboard.getBoundingClientRect();\n\t\tconst minX = rect.left;\n\t\tconst minY = rect.top;\n\t\tconst maxX = rect.right - tileSize;\n\t\tconst maxY = rect.bottom - tileSize;\n\n\t\tactivePiece.style.position = 'fixed';\n\n\t\t// x axis limits\n\t\tif(x < minX){\n\t\t\tactivePiece.style.left = `${minX}px`;\n\t\t} else if(x > maxX){\n\t\t\tactivePiece.style.left = `${maxX}px`;\n\t\t} else{\n\t\t\tactivePiece.style.left = `${x}px`;\n\t\t}\n\n\t\t// y axis limits\n\t\tif(y < minY){\n\t\t\tactivePiece.style.top = `${minY}px`;\n\t\t} else if(y > maxY){\n\t\t\tactivePiece.style.top = `${maxY}px`;\n\t\t} else{\n\t\t\tactivePiece.style.top = `${y}px`;\n\t\t}\n\t\t\n\t}\n}\n\nfunction dropPiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst target = pickTileFromCursor(e.clientX, e.clientY);\n\t\tperformMove(target);\n\t\t//reset piece position\n\t\tactivePiece.style.position= 'relative';\n\t\tactivePiece.style.removeProperty(\"top\");\n\t\tactivePiece.style.removeProperty(\"left\");\n\t\tactivePiece.style.removeProperty(\"z-index\");\n\t\tsetActivePiece(null);\n\t}\n}\n\n\tfunction promotePawn(pieceType: PieceType){\n\t\tif(promotionPawn===undefined){\n\t\t\treturn;\n\t\t}\n\t\tconst updatedPieces = pieces.reduce((results, piece) =>{\n\n\t\t\tif(samePosition(piece.position, promotionPawn?.position)){\n\t\t\t\tpiece.type = pieceType;\n\t\t\t\tconst teamType = (piece.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\tlet image = \"\";\n\t\t\t\tswitch(pieceType){\n\t\t\t\t\tcase PieceType.ROOK:{\n\t\t\t\t\t\timage = \"rook\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.BISHOP:{\n\t\t\t\t\t\timage = \"bishop\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.KNIGHT:{\n\t\t\t\t\t\timage = \"knight\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.QUEEN:{\n\t\t\t\t\t\timage = \"queen\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpiece.image = `assets/images/${image}_${teamType}.svg`;\n\t\t\t}\n\n\t\t\tresults.push(piece);\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tmodalRef.current?.classList.add(\"hidden\");\n\t\tsetAwaitingPromotion(false);\n\t\tif(online && online.status === 'playing' && lastMove){\n\t\t\tonline.socket?.emit('move', {\n\t\t\t\troomId: online.roomId,\n\t\t\t\tfrom: lastMove.from,\n\t\t\t\tto: lastMove.to,\n\t\t\t\tpromotionType: pieceType\n\t\t\t});\n\t\t\tsetClockStarted(true);\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else if(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}\n\n\n\tfunction promotionTeamType(){\n\t\treturn (promotionPawn?.team === TeamType.OUR)?\"w\":\"b\";\n\t}\n\n\tfunction formatTime(totalSeconds: number | null){\n\t\tif(totalSeconds === null) return '--:--';\n\t\tconst m = Math.floor(totalSeconds / 60);\n\t\tconst s = totalSeconds % 60;\n\t\treturn `${m}:${s.toString().padStart(2,'0')}`;\n\t}\n\n\tlet board = [];\n\n\tfor(let y= YAXIS.length-1;y>=0;y--){\n\t\tfor(let x=0;x<XAXIS.length;x++){\n\n\t\t\t// check whether the sum of numbers x,y is even to draw each tile\n\t\t\tconst isEven = (x+y+2)%2===0;\n\t\t\tlet img = undefined;\n\n\t\t\tpieces.forEach(p=> {\n\t\t\t\tif(samePosition(p.position, {x:x, y:y})){\n\t\t\t\t\timg=p.image\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tlet currentPiece = pieces.find(p=> samePosition(p.position,grabPosition));\n\t\t\tlet highlight = (currentPiece?.possibleMoves) ? currentPiece.possibleMoves.some(p=> samePosition(p, {x:x , y:y})): false;\n\t\t\tconst targetHasPiece = pieces.some(p => samePosition(p.position, {x, y}));\n\t\t\tconst capture = highlight && targetHasPiece;\n\t\t\tconst handleClick = highlight ? () => performMove({ x, y }) : undefined;\n\t\t\t\n\t\t\tboard.push(\n\t\t\t\t\t<Tile key={`${x},${y}`} isEven={isEven} image={img} highlight={highlight} capture={capture} onClick={handleClick}/> \n\t\t\t)\n\t\t}\n\t}\n\n\n\treturn(\n\t\t<>\n\t\t<div id=\"pawn-promotion-modal\" className=\"hidden\" ref={modalRef}>\n\t\t\t<div className=\"modal-body\">\n\n\t\t\t<img onClick={()=> promotePawn(PieceType.ROOK)} src={`assets/images/rook_${promotionTeamType()}.svg`} alt=\"promote rook\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.BISHOP)} src={`assets/images/bishop_${promotionTeamType()}.svg`} alt=\"promote bishop\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.KNIGHT)} src={`assets/images/knight_${promotionTeamType()}.svg`} alt=\"promote knight\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.QUEEN)} src={`assets/images/queen_${promotionTeamType()}.svg`} alt=\"promote queen\"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div className=\"board-layout\">\n\n\t\t\t{/* timer panel */}\n\t\t\t{(online?.status === 'playing') && (\n\t\t\t<div className=\"timer-panel\">\n\t\t\t\t<div className={`timer-block ${currentTurn==='black' ? 'active' : ''}`}>\n\t\t\t\t\t<div className=\"timer-label\">Black</div>\n\t\t\t\t\t<div className=\"timer-value\">{formatTime(blackTimeLeft)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div className={`timer-block ${currentTurn==='white' ? 'active' : ''}`}>\n\t\t\t\t\t<div className=\"timer-label\">White</div>\n\t\t\t\t\t<div className=\"timer-value\">{formatTime(whiteTimeLeft)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t)}\n\n\n\t\t\t<div \n\t\t\t\tonMouseMove={(e)=>movePiece(e)} \n\t\t\t\tonMouseDown={e=> grabPiece(e)} \n\t\t\t\tonMouseUp={(e)=> dropPiece(e)}\n\t\t\t\tid=\"chessboard\"\n\t\t\t\tref={chessboardRef}>\n\t\t\t\t\t{board}\n\t\t\t</div>\n\t\t</div>\n\t\t</>\n\t)\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}