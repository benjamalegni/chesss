{"ast":null,"code":"import'./Chessboard.css';import Tile from'../Tile/Tile';import Referee from'../../referee/Referee';import{useEffect,useRef,useState}from'react';import{XAXIS,YAXIS,TeamType,PieceType,initialBoardState,GRIDSIZE,samePosition}from'../../Constants';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function Chessboard(_ref){let{online,timeLimitSeconds}=_ref;const[activePiece,setActivePiece]=useState(null);const[grabPosition,setGrabPosition]=useState({x:-1,y:-1});const[pieces,setPieces]=useState(initialBoardState);const chessboardRef=useRef(null);const referee=new Referee();const[promotionPawn,setPromotionPawn]=useState();const modalRef=useRef(null);const[currentTurn,setCurrentTurn]=useState('white');const[lastMove,setLastMove]=useState(null);const[awaitingPromotion,setAwaitingPromotion]=useState(false);// Clock state\nconst[whiteTimeLeft,setWhiteTimeLeft]=useState(null);const[blackTimeLeft,setBlackTimeLeft]=useState(null);const[clockStarted,setClockStarted]=useState(false);function getAllowedTeamForMe(){if(!online||online.status!=='playing'||!online.myColor){return null;}return online.myColor==='white'?TeamType.OUR:TeamType.OPPONENT;}function isMyTurn(){if(!online||online.status!=='playing'||!online.myColor){return true;// offline mode: always allowed\n}return online.myColor===currentTurn;}// Initialize turn and timers when a game starts or time limit provided\nuseEffect(()=>{if((online===null||online===void 0?void 0:online.status)==='playing'){setCurrentTurn('white');if(whiteTimeLeft===null||blackTimeLeft===null){const limit=typeof timeLimitSeconds==='number'&&timeLimitSeconds>0?timeLimitSeconds:300;setWhiteTimeLeft(limit);setBlackTimeLeft(limit);}setClockStarted(true);}else{setClockStarted(false);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[online===null||online===void 0?void 0:online.status,timeLimitSeconds]);// Opponent move listener\nuseEffect(()=>{const s=online===null||online===void 0?void 0:online.socket;if(!s)return;const onMove=msg=>{try{setClockStarted(true);if(msg.type==='move'){// compatibility if server sends type wrapper\n}const from=msg.from;const to=msg.to;const promotion=msg.promotionType;setPieces(currentPieces=>{let updated=currentPieces;const movingPiece=updated.find(p=>samePosition(p.position,from));if(!movingPiece){return updated;}const isEnPassantMove=Referee.isEnPassantMove(from,to,movingPiece.type,movingPiece.team,updated);const pawnDirecion=movingPiece.team===TeamType.OUR?1:-1;if(isEnPassantMove){updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=false;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,{x:to.x,y:to.y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}else{updated=updated.reduce((results,piece)=>{if(samePosition(piece.position,from)){piece.enPassant=Math.abs(from.y-to.y)===2&&piece.type===PieceType.PAWN;piece.position.x=to.x;piece.position.y=to.y;results.push(piece);}else if(!samePosition(piece.position,to)){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);}if(promotion!==undefined){const promoted=updated.find(p=>samePosition(p.position,to));if(promoted){promoted.type=promotion;const teamType=promoted.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(promotion){case PieceType.ROOK:image=\"rook\";break;case PieceType.BISHOP:image=\"bishop\";break;case PieceType.KNIGHT:image=\"knight\";break;case PieceType.QUEEN:image=\"queen\";break;}if(image){promoted.image=`${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;}}}return updated;});setCurrentTurn(prev=>prev==='white'?'black':'white');}catch(_e){// ignore\n}};s.on('move',onMove);return()=>{s.off('move',onMove);};},[online]);function updateValidMoves(){setPieces(currentPieces=>{return currentPieces.map(p=>{p.possibleMoves=referee.getValidMoves(p,currentPieces);return p;});});}// Clock ticking effect\nuseEffect(()=>{if(whiteTimeLeft===null||blackTimeLeft===null)return;if(!online||online.status!=='playing')return;if(awaitingPromotion)return;if(!clockStarted)return;const interval=setInterval(()=>{if(currentTurn==='white'){setWhiteTimeLeft(prev=>{if(prev===null)return prev;const next=Math.max(0,prev-1);return next;});}else{setBlackTimeLeft(prev=>{if(prev===null)return prev;const next=Math.max(0,prev-1);return next;});}},1000);return()=>clearInterval(interval);},[online,online===null||online===void 0?void 0:online.status,currentTurn,whiteTimeLeft,blackTimeLeft,awaitingPromotion,clockStarted]);// Ensure the clock starts after the very first move (local or remote)\nuseEffect(()=>{if(lastMove&&typeof timeLimitSeconds==='number'&&timeLimitSeconds>0){setClockStarted(true);}},[lastMove,timeLimitSeconds]);function performMove(target){const currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));if(!currentPiece)return;const{x,y}=target;const validMove=referee.isValidMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const isEnPassantMove=Referee.isEnPassantMove(grabPosition,{x,y},currentPiece.type,currentPiece.team,pieces);const pawnDirecion=currentPiece.team===TeamType.OUR?1:-1;if(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||currentPiece.team!==myTeam){return;}// Optional: stop moves if your time is up\nif(typeof timeLimitSeconds==='number'&&timeLimitSeconds>0){if(currentTurn==='white'&&whiteTimeLeft===0||currentTurn==='black'&&blackTimeLeft===0){return;}}}if(isEnPassantMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=false;piece.position.x=x;piece.position.y=y;results.push(piece);}else if(!samePosition(piece.position,{x,y:y-pawnDirecion})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});setClockStarted(true);if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket;(_online$socket=online.socket)===null||_online$socket===void 0?void 0:_online$socket.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}else if(validMove){const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,grabPosition)){piece.enPassant=Math.abs(grabPosition.y-y)===2&&piece.type===PieceType.PAWN;piece.position.x=x;piece.position.y=y;let promotionRow=piece.team===TeamType.OUR?7:0;if(y===promotionRow&&piece.type===PieceType.PAWN){var _modalRef$current;(_modalRef$current=modalRef.current)===null||_modalRef$current===void 0?void 0:_modalRef$current.classList.remove(\"hidden\");setPromotionPawn(piece);setAwaitingPromotion(true);}results.push(piece);}else if(!samePosition(piece.position,{x,y})){if(piece.type===PieceType.PAWN){piece.enPassant=false;}results.push(piece);}return results;},[]);setPieces(updatedPieces);setLastMove({from:grabPosition,to:{x,y}});if(!awaitingPromotion){setClockStarted(true);if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}else{var _online$socket2;(_online$socket2=online.socket)===null||_online$socket2===void 0?void 0:_online$socket2.emit('move',{roomId:online.roomId,from:grabPosition,to:{x,y}});setCurrentTurn(prev=>prev==='white'?'black':'white');}}}}function pickTileFromCursor(clientX,clientY){const chessboard=chessboardRef.current;if(!chessboard)return{x:-1,y:-1};const rect=chessboard.getBoundingClientRect();const relX=clientX-rect.left;const relY=clientY-rect.top;const x=Math.floor(relX/GRIDSIZE);const y=Math.abs(Math.ceil((relY-rect.height)/GRIDSIZE));// invert axis\nreturn{x,y};}function grabPiece(e){updateValidMoves();const chessboard=chessboardRef.current;const element=e.target;if(element.classList.contains(\"chess-piece\")&&chessboard){const{x:grabX,y:grabY}=pickTileFromCursor(e.clientX,e.clientY);const pieceAtTile=pieces.find(p=>samePosition(p.position,{x:grabX,y:grabY}));// Online restrictions\nif(online&&online.status==='playing'){const myTeam=getAllowedTeamForMe();if(!isMyTurn()||myTeam===null||!pieceAtTile||pieceAtTile.team!==myTeam){return;// can't grab\n}}setGrabPosition({x:grabX,y:grabY});const x=e.clientX-GRIDSIZE/2;const y=e.clientY-GRIDSIZE/2;element.style.position='fixed';element.style.left=`${x}px`;element.style.top=`${y}px`;element.style.zIndex='1000';setActivePiece(element);}}function movePiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const x=e.clientX-GRIDSIZE/2;const y=e.clientY-GRIDSIZE/2;const rect=chessboard.getBoundingClientRect();const minX=rect.left;const minY=rect.top;const maxX=rect.right-GRIDSIZE;const maxY=rect.bottom-GRIDSIZE;activePiece.style.position='fixed';// x axis limits\nif(x<minX){activePiece.style.left=`${minX}px`;}else if(x>maxX){activePiece.style.left=`${maxX}px`;}else{activePiece.style.left=`${x}px`;}// y axis limits\nif(y<minY){activePiece.style.top=`${minY}px`;}else if(y>maxY){activePiece.style.top=`${maxY}px`;}else{activePiece.style.top=`${y}px`;}}}function dropPiece(e){const chessboard=chessboardRef.current;if(activePiece&&chessboard){const target=pickTileFromCursor(e.clientX,e.clientY);performMove(target);//reset piece position\nactivePiece.style.position='relative';activePiece.style.removeProperty(\"top\");activePiece.style.removeProperty(\"left\");activePiece.style.removeProperty(\"z-index\");setActivePiece(null);}}function promotePawn(pieceType){var _modalRef$current2;if(promotionPawn===undefined){return;}const updatedPieces=pieces.reduce((results,piece)=>{if(samePosition(piece.position,promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.position)){piece.type=pieceType;const teamType=piece.team===TeamType.OUR?\"w\":\"b\";let image=\"\";switch(pieceType){case PieceType.ROOK:{image=\"rook\";break;}case PieceType.BISHOP:{image=\"bishop\";break;}case PieceType.KNIGHT:{image=\"knight\";break;}case PieceType.QUEEN:{image=\"queen\";break;}}piece.image=`${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;}results.push(piece);return results;},[]);setPieces(updatedPieces);(_modalRef$current2=modalRef.current)===null||_modalRef$current2===void 0?void 0:_modalRef$current2.classList.add(\"hidden\");setAwaitingPromotion(false);if(online&&online.status==='playing'&&lastMove){var _online$socket3;(_online$socket3=online.socket)===null||_online$socket3===void 0?void 0:_online$socket3.emit('move',{roomId:online.roomId,from:lastMove.from,to:lastMove.to,promotionType:pieceType});setClockStarted(true);setCurrentTurn(prev=>prev==='white'?'black':'white');}else if(!online||online.status!=='playing'){setCurrentTurn(prev=>prev==='white'?'black':'white');}}function promotionTeamType(){return(promotionPawn===null||promotionPawn===void 0?void 0:promotionPawn.team)===TeamType.OUR?\"w\":\"b\";}function formatTime(totalSeconds){if(totalSeconds===null)return'--:--';const m=Math.floor(totalSeconds/60);const s=totalSeconds%60;return`${m}:${s.toString().padStart(2,'0')}`;}let board=[];for(let y=YAXIS.length-1;y>=0;y--){for(let x=0;x<XAXIS.length;x++){// check whether the sum of numbers x,y is even to draw each tile\nconst isEven=(x+y+2)%2===0;let img=undefined;pieces.forEach(p=>{if(samePosition(p.position,{x:x,y:y})){img=p.image;}});let currentPiece=pieces.find(p=>samePosition(p.position,grabPosition));let highlight=currentPiece!==null&&currentPiece!==void 0&&currentPiece.possibleMoves?currentPiece.possibleMoves.some(p=>samePosition(p,{x:x,y:y})):false;const targetHasPiece=pieces.some(p=>samePosition(p.position,{x,y}));const capture=highlight&&targetHasPiece;const handleClick=highlight?()=>performMove({x,y}):undefined;board.push(/*#__PURE__*/_jsx(Tile,{isEven:isEven,image:img,highlight:highlight,capture:capture,onClick:handleClick},`${x},${y}`));}}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{id:\"pawn-promotion-modal\",className:\"hidden\",ref:modalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.ROOK),src:`${process.env.PUBLIC_URL}/assets/images/rook_${promotionTeamType()}.svg`,alt:\"promote rook\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.BISHOP),src:`${process.env.PUBLIC_URL}/assets/images/bishop_${promotionTeamType()}.svg`,alt:\"promote bishop\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.KNIGHT),src:`${process.env.PUBLIC_URL}/assets/images/knight_${promotionTeamType()}.svg`,alt:\"promote knight\"}),/*#__PURE__*/_jsx(\"img\",{onClick:()=>promotePawn(PieceType.QUEEN),src:`${process.env.PUBLIC_URL}/assets/images/queen_${promotionTeamType()}.svg`,alt:\"promote queen\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-layout\",children:[(online===null||online===void 0?void 0:online.status)==='playing'&&/*#__PURE__*/_jsxs(\"div\",{className:\"timer-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:`timer-block ${currentTurn==='black'?'active':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"timer-label\",children:\"Black\"}),/*#__PURE__*/_jsx(\"div\",{className:\"timer-value\",children:formatTime(blackTimeLeft)})]}),/*#__PURE__*/_jsxs(\"div\",{className:`timer-block ${currentTurn==='white'?'active':''}`,children:[/*#__PURE__*/_jsx(\"div\",{className:\"timer-label\",children:\"White\"}),/*#__PURE__*/_jsx(\"div\",{className:\"timer-value\",children:formatTime(whiteTimeLeft)})]})]}),/*#__PURE__*/_jsx(\"div\",{onMouseMove:e=>movePiece(e),onMouseDown:e=>grabPiece(e),onMouseUp:e=>dropPiece(e),id:\"chessboard\",ref:chessboardRef,children:board})]})]});}","map":{"version":3,"names":["Tile","Referee","useEffect","useRef","useState","XAXIS","YAXIS","TeamType","PieceType","initialBoardState","GRIDSIZE","samePosition","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Chessboard","_ref","online","timeLimitSeconds","activePiece","setActivePiece","grabPosition","setGrabPosition","x","y","pieces","setPieces","chessboardRef","referee","promotionPawn","setPromotionPawn","modalRef","currentTurn","setCurrentTurn","lastMove","setLastMove","awaitingPromotion","setAwaitingPromotion","whiteTimeLeft","setWhiteTimeLeft","blackTimeLeft","setBlackTimeLeft","clockStarted","setClockStarted","getAllowedTeamForMe","status","myColor","OUR","OPPONENT","isMyTurn","limit","s","socket","onMove","msg","type","from","to","promotion","promotionType","currentPieces","updated","movingPiece","find","p","position","isEnPassantMove","team","pawnDirecion","reduce","results","piece","enPassant","push","PAWN","Math","abs","undefined","promoted","teamType","image","ROOK","BISHOP","KNIGHT","QUEEN","process","env","PUBLIC_URL","prev","_e","on","off","updateValidMoves","map","possibleMoves","getValidMoves","interval","setInterval","next","max","clearInterval","performMove","target","currentPiece","validMove","isValidMove","myTeam","updatedPieces","_online$socket","emit","roomId","promotionRow","_modalRef$current","current","classList","remove","_online$socket2","pickTileFromCursor","clientX","clientY","chessboard","rect","getBoundingClientRect","relX","left","relY","top","floor","ceil","height","grabPiece","e","element","contains","grabX","grabY","pieceAtTile","style","zIndex","movePiece","minX","minY","maxX","right","maxY","bottom","dropPiece","removeProperty","promotePawn","pieceType","_modalRef$current2","add","_online$socket3","promotionTeamType","formatTime","totalSeconds","m","toString","padStart","board","length","isEven","img","forEach","highlight","some","targetHasPiece","capture","handleClick","onClick","children","id","className","ref","src","alt","onMouseMove","onMouseDown","onMouseUp"],"sources":["/home/Outer/Documents/chesss/src/components/Chessboard/Chessboard.tsx"],"sourcesContent":["import './Chessboard.css';\nimport Tile from '../Tile/Tile'\nimport Referee from '../../referee/Referee'\nimport { useEffect, useRef, useState } from 'react';\nimport { XAXIS, YAXIS, Piece, TeamType, PieceType, initialBoardState, Position, GRIDSIZE, samePosition } from '../../Constants';\nimport type { Socket } from 'socket.io-client';\n\ninterface OnlineProps{\n\tsocket: Socket | null;\n\tstatus: 'offline' | 'waiting' | 'playing';\n\troomId?: string;\n\tmyColor?: 'white' | 'black';\n}\n\nexport default function Chessboard({ online, timeLimitSeconds }: { online?: OnlineProps, timeLimitSeconds?: number }){\nconst [activePiece, setActivePiece] = useState<HTMLElement | null>(null)\nconst [grabPosition, setGrabPosition] = useState<Position>({x:-1, y:-1});\nconst [pieces, setPieces] = useState<Piece[]>(initialBoardState);\nconst chessboardRef = useRef<HTMLDivElement>(null);\nconst referee = new Referee();\nconst [promotionPawn, setPromotionPawn] = useState<Piece>();\nconst modalRef = useRef<HTMLDivElement>(null);\nconst [currentTurn, setCurrentTurn] = useState<'white'|'black'>('white');\nconst [lastMove, setLastMove] = useState<{from: Position, to: Position} | null>(null);\nconst [awaitingPromotion, setAwaitingPromotion] = useState<boolean>(false);\n\n// Clock state\nconst [whiteTimeLeft, setWhiteTimeLeft] = useState<number | null>(null);\nconst [blackTimeLeft, setBlackTimeLeft] = useState<number | null>(null);\nconst [clockStarted, setClockStarted] = useState<boolean>(false);\n\nfunction getAllowedTeamForMe(): TeamType | null{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn null;\n\t}\n\treturn online.myColor === 'white' ? TeamType.OUR : TeamType.OPPONENT;\n}\n\nfunction isMyTurn(): boolean{\n\tif(!online || online.status !== 'playing' || !online.myColor){\n\t\treturn true; // offline mode: always allowed\n\t}\n\treturn online.myColor === currentTurn;\n}\n\n// Initialize turn and timers when a game starts or time limit provided\nuseEffect(()=>{\n\tif(online?.status === 'playing'){\n\t\tsetCurrentTurn('white');\n\t\tif(whiteTimeLeft === null || blackTimeLeft === null){\n\t\t\tconst limit = (typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0) ? timeLimitSeconds : 300;\n\t\t\tsetWhiteTimeLeft(limit);\n\t\t\tsetBlackTimeLeft(limit);\n\t\t}\n\t\tsetClockStarted(true);\n\t} else {\n\t\tsetClockStarted(false);\n\t}\n// eslint-disable-next-line react-hooks/exhaustive-deps\n}, [online?.status, timeLimitSeconds]);\n\n// Opponent move listener\nuseEffect(()=>{\n\tconst s = online?.socket;\n\tif(!s) return;\n\tconst onMove = (msg: any) => {\n\t\ttry{\n\t\t\tsetClockStarted(true);\n\t\t\tif(msg.type === 'move'){\n\t\t\t\t// compatibility if server sends type wrapper\n\t\t\t}\n\t\t\tconst from: Position = msg.from;\n\t\t\tconst to: Position = msg.to;\n\t\t\tconst promotion: PieceType | undefined = msg.promotionType;\n\t\t\tsetPieces((currentPieces)=>{\n\t\t\t\tlet updated = currentPieces;\n\t\t\t\tconst movingPiece = updated.find(p=> samePosition(p.position, from));\n\t\t\t\tif(!movingPiece){\n\t\t\t\t\treturn updated;\n\t\t\t\t}\n\t\t\t\tconst isEnPassantMove = Referee.isEnPassantMove(from, to, movingPiece.type, movingPiece.team, updated);\n\t\t\t\tconst pawnDirecion = movingPiece.team === TeamType.OUR?1:-1;\n\t\t\t\tif(isEnPassantMove){\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\tpiece.position.x=to.x;\n\t\t\t\t\t\t\tpiece.position.y=to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}else if(!samePosition(piece.position, {x: to.x, y: to.y - pawnDirecion})){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t} else {\n\t\t\t\t\tupdated = updated.reduce((results, piece)=>{\n\t\t\t\t\t\tif(samePosition(piece.position, from)){\n\t\t\t\t\t\t\tpiece.enPassant = Math.abs(from.y - to.y)===2 && (piece.type===PieceType.PAWN);\n\t\t\t\t\t\t\tpiece.position.x = to.x;\n\t\t\t\t\t\t\tpiece.position.y = to.y;\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t} else if(!samePosition(piece.position, to)){\n\t\t\t\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresults.push(piece);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}, [] as Piece[]);\n\t\t\t\t}\n\t\t\t\tif(promotion !== undefined){\n\t\t\t\t\tconst promoted = updated.find(p=> samePosition(p.position, to));\n\t\t\t\t\tif(promoted){\n\t\t\t\t\t\tpromoted.type = promotion;\n\t\t\t\t\t\tconst teamType = (promoted.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\t\t\tlet image = \"\";\n\t\t\t\t\t\tswitch(promotion){\n\t\t\t\t\t\t\tcase PieceType.ROOK: image = \"rook\"; break;\n\t\t\t\t\t\t\tcase PieceType.BISHOP: image = \"bishop\"; break;\n\t\t\t\t\t\t\tcase PieceType.KNIGHT: image = \"knight\"; break;\n\t\t\t\t\t\t\tcase PieceType.QUEEN: image = \"queen\"; break;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(image){\n\t\t\t\t\t\t\tpromoted.image = `${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn updated;\n\t\t\t});\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}catch(_e){\n\t\t\t// ignore\n\t\t}\n\t};\n\ts.on('move', onMove);\n\treturn () => {\n\t\ts.off('move', onMove);\n\t};\n}, [online]);\n\nfunction updateValidMoves(){\n\tsetPieces((currentPieces) => {\n\t\treturn currentPieces.map(p=>{\n\t\t\tp.possibleMoves = referee.getValidMoves(p, currentPieces);\n\t\t\treturn p;\n\n\t\t});\n\t});\n}\n\n// Clock ticking effect\nuseEffect(()=>{\n\tif(whiteTimeLeft === null || blackTimeLeft === null) return;\n\tif(!online || online.status !== 'playing') return;\n\tif(awaitingPromotion) return;\n\tif(!clockStarted) return;\n\tconst interval = setInterval(()=>{\n\t\tif(currentTurn === 'white'){\n\t\t\tsetWhiteTimeLeft(prev => {\n\t\t\t\tif(prev === null) return prev;\n\t\t\t\tconst next = Math.max(0, prev - 1);\n\t\t\t\treturn next;\n\t\t\t});\n\t\t} else {\n\t\t\tsetBlackTimeLeft(prev => {\n\t\t\t\tif(prev === null) return prev;\n\t\t\t\tconst next = Math.max(0, prev - 1);\n\t\t\t\treturn next;\n\t\t\t});\n\t\t}\n\t}, 1000);\n\treturn () => clearInterval(interval);\n}, [online, online?.status, currentTurn, whiteTimeLeft, blackTimeLeft, awaitingPromotion, clockStarted]);\n\n// Ensure the clock starts after the very first move (local or remote)\nuseEffect(()=>{\n\tif(lastMove && typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0){\n\t\tsetClockStarted(true);\n\t}\n}, [lastMove, timeLimitSeconds]);\n\nfunction performMove(target: Position){\n\tconst currentPiece = pieces.find((p)=> samePosition(p.position, grabPosition));\n\tif(!currentPiece) return;\n\tconst { x, y } = target;\n\tconst validMove = referee.isValidMove(grabPosition, {x,y}, currentPiece.type,currentPiece.team, pieces);\n\tconst isEnPassantMove = Referee.isEnPassantMove(grabPosition, {x,y},currentPiece.type,currentPiece.team, pieces)\n\tconst pawnDirecion = currentPiece.team === TeamType.OUR?1:-1;\n\n\tif(online && online.status === 'playing'){\n\t\tconst myTeam = getAllowedTeamForMe();\n\t\tif(!isMyTurn() || myTeam === null || currentPiece.team !== myTeam){\n\t\t\treturn;\n\t\t}\n\t\t// Optional: stop moves if your time is up\n\t\tif(typeof timeLimitSeconds === 'number' && timeLimitSeconds > 0){\n\t\t\tif((currentTurn === 'white' && whiteTimeLeft === 0) || (currentTurn === 'black' && blackTimeLeft === 0)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tif(isEnPassantMove){\n\t\tconst updatedPieces = pieces.reduce((results, piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant=false;\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!samePosition(piece.position, {x, y: y-pawnDirecion})){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tsetClockStarted(true);\n\t\tif(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else {\n\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}else if(validMove){\n\t\tconst updatedPieces = pieces.reduce((results,piece)=>{\n\t\t\tif(samePosition(piece.position, grabPosition)){\n\t\t\t\tpiece.enPassant = Math.abs(grabPosition.y-y)===2 &&(piece.type===PieceType.PAWN)\n\t\t\t\tpiece.position.x=x;\n\t\t\t\tpiece.position.y=y;\n\t\t\t\tlet promotionRow = piece.team === TeamType.OUR ? 7:0;\n\t\t\t\tif(y===promotionRow && piece.type === PieceType.PAWN){\n\t\t\t\t\tmodalRef.current?.classList.remove(\"hidden\")\n\t\t\t\t\tsetPromotionPawn(piece);\n\t\t\t\t\tsetAwaitingPromotion(true);\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}else if(!(samePosition(piece.position, {x,y}))){\n\t\t\t\tif(piece.type===PieceType.PAWN){\n\t\t\t\t\tpiece.enPassant=false;\n\t\t\t\t}\n\t\t\t\tresults.push(piece);\n\t\t\t}\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tsetLastMove({from: grabPosition, to: {x, y}});\n\t\tif(!(awaitingPromotion)){\n\t\t\tsetClockStarted(true);\n\t\t\tif(!online || online.status !== 'playing'){\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t} else {\n\t\t\t\tonline.socket?.emit('move', { roomId: online.roomId, from: grabPosition, to: {x, y} });\n\t\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction pickTileFromCursor(clientX: number, clientY: number){\n\tconst chessboard = chessboardRef.current;\n\tif(!chessboard) return { x: -1, y: -1 };\n\tconst rect = chessboard.getBoundingClientRect();\n\tconst relX = clientX - rect.left;\n\tconst relY = clientY - rect.top;\n\tconst x = Math.floor(relX / GRIDSIZE);\n\tconst y = Math.abs(Math.ceil((relY - rect.height)/GRIDSIZE)); // invert axis\n\treturn { x, y };\n}\n\nfunction grabPiece(e: React.MouseEvent){\n\tupdateValidMoves();\n\n\tconst chessboard = chessboardRef.current;\n\tconst element = e.target as HTMLElement;\n\n\tif(element.classList.contains(\"chess-piece\") && chessboard){\n\t\tconst { x: grabX, y: grabY } = pickTileFromCursor(e.clientX, e.clientY);\n\t\tconst pieceAtTile = pieces.find(p => samePosition(p.position, {x: grabX, y: grabY}));\n\n\t\t// Online restrictions\n\t\tif(online && online.status === 'playing'){\n\t\t\tconst myTeam = getAllowedTeamForMe();\n\t\t\tif(!isMyTurn() || myTeam === null || !pieceAtTile || pieceAtTile.team !== myTeam){\n\t\t\t\treturn; // can't grab\n\t\t\t}\n\t\t}\n\n\t\tsetGrabPosition({x:grabX, y:grabY})\n\n\t\tconst x = e.clientX - GRIDSIZE/2;\n\t\tconst y = e.clientY - GRIDSIZE/2;\n\t\telement.style.position = 'fixed';\n\t\telement.style.left = `${x}px`;\n\t\telement.style.top = `${y}px`;\n\t\telement.style.zIndex = '1000';\n\n\t\tsetActivePiece(element);\n\t}\n}\n\nfunction movePiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst x = e.clientX - GRIDSIZE/2;\n\t\tconst y = e.clientY - GRIDSIZE/2;\n\n\t\tconst rect = chessboard.getBoundingClientRect();\n\t\tconst minX = rect.left;\n\t\tconst minY = rect.top;\n\t\tconst maxX = rect.right - GRIDSIZE;\n\t\tconst maxY = rect.bottom - GRIDSIZE;\n\n\t\tactivePiece.style.position = 'fixed';\n\n\t\t// x axis limits\n\t\tif(x < minX){\n\t\t\tactivePiece.style.left = `${minX}px`;\n\t\t} else if(x > maxX){\n\t\t\tactivePiece.style.left = `${maxX}px`;\n\t\t} else{\n\t\t\tactivePiece.style.left = `${x}px`;\n\t\t}\n\n\t\t// y axis limits\n\t\tif(y < minY){\n\t\t\tactivePiece.style.top = `${minY}px`;\n\t\t} else if(y > maxY){\n\t\t\tactivePiece.style.top = `${maxY}px`;\n\t\t} else{\n\t\t\tactivePiece.style.top = `${y}px`;\n\t\t}\n\t\t\n\t}\n}\n\nfunction dropPiece(e: React.MouseEvent){\n\tconst chessboard = chessboardRef.current;\n\tif(activePiece && chessboard){\n\t\tconst target = pickTileFromCursor(e.clientX, e.clientY);\n\t\tperformMove(target);\n\t\t//reset piece position\n\t\tactivePiece.style.position= 'relative';\n\t\tactivePiece.style.removeProperty(\"top\");\n\t\tactivePiece.style.removeProperty(\"left\");\n\t\tactivePiece.style.removeProperty(\"z-index\");\n\t\tsetActivePiece(null);\n\t}\n}\n\n\tfunction promotePawn(pieceType: PieceType){\n\t\tif(promotionPawn===undefined){\n\t\t\treturn;\n\t\t}\n\t\tconst updatedPieces = pieces.reduce((results, piece) =>{\n\n\t\t\tif(samePosition(piece.position, promotionPawn?.position)){\n\t\t\t\tpiece.type = pieceType;\n\t\t\t\tconst teamType = (piece.team === TeamType.OUR)?\"w\":\"b\";\n\t\t\t\tlet image = \"\";\n\t\t\t\tswitch(pieceType){\n\t\t\t\t\tcase PieceType.ROOK:{\n\t\t\t\t\t\timage = \"rook\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.BISHOP:{\n\t\t\t\t\t\timage = \"bishop\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.KNIGHT:{\n\t\t\t\t\t\timage = \"knight\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tcase PieceType.QUEEN:{\n\t\t\t\t\t\timage = \"queen\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpiece.image = `${process.env.PUBLIC_URL}/assets/images/${image}_${teamType}.svg`;\n\t\t\t}\n\n\t\t\tresults.push(piece);\n\t\t\treturn results;\n\t\t}, [] as Piece[])\n\t\tsetPieces(updatedPieces);\n\t\tmodalRef.current?.classList.add(\"hidden\");\n\t\tsetAwaitingPromotion(false);\n\t\tif(online && online.status === 'playing' && lastMove){\n\t\t\tonline.socket?.emit('move', {\n\t\t\t\troomId: online.roomId,\n\t\t\t\tfrom: lastMove.from,\n\t\t\t\tto: lastMove.to,\n\t\t\t\tpromotionType: pieceType\n\t\t\t});\n\t\t\tsetClockStarted(true);\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t} else if(!online || online.status !== 'playing'){\n\t\t\tsetCurrentTurn(prev => prev === 'white' ? 'black' : 'white');\n\t\t}\n\t}\n\n\n\tfunction promotionTeamType(){\n\t\treturn (promotionPawn?.team === TeamType.OUR)?\"w\":\"b\";\n\t}\n\n\tfunction formatTime(totalSeconds: number | null){\n\t\tif(totalSeconds === null) return '--:--';\n\t\tconst m = Math.floor(totalSeconds / 60);\n\t\tconst s = totalSeconds % 60;\n\t\treturn `${m}:${s.toString().padStart(2,'0')}`;\n\t}\n\n\tlet board = [];\n\n\tfor(let y= YAXIS.length-1;y>=0;y--){\n\t\tfor(let x=0;x<XAXIS.length;x++){\n\n\t\t\t// check whether the sum of numbers x,y is even to draw each tile\n\t\t\tconst isEven = (x+y+2)%2===0;\n\t\t\tlet img = undefined;\n\n\t\t\tpieces.forEach(p=> {\n\t\t\t\tif(samePosition(p.position, {x:x, y:y})){\n\t\t\t\t\timg=p.image\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tlet currentPiece = pieces.find(p=> samePosition(p.position,grabPosition));\n\t\t\tlet highlight = (currentPiece?.possibleMoves) ? currentPiece.possibleMoves.some(p=> samePosition(p, {x:x , y:y})): false;\n\t\t\tconst targetHasPiece = pieces.some(p => samePosition(p.position, {x, y}));\n\t\t\tconst capture = highlight && targetHasPiece;\n\t\t\tconst handleClick = highlight ? () => performMove({ x, y }) : undefined;\n\t\t\t\n\t\t\tboard.push(\n\t\t\t\t\t<Tile key={`${x},${y}`} isEven={isEven} image={img} highlight={highlight} capture={capture} onClick={handleClick}/> \n\t\t\t)\n\t\t}\n\t}\n\n\n\treturn(\n\t\t<>\n\t\t<div id=\"pawn-promotion-modal\" className=\"hidden\" ref={modalRef}>\n\t\t\t<div className=\"modal-body\">\n\n\t\t\t<img onClick={()=> promotePawn(PieceType.ROOK)} src={`${process.env.PUBLIC_URL}/assets/images/rook_${promotionTeamType()}.svg`} alt=\"promote rook\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.BISHOP)} src={`${process.env.PUBLIC_URL}/assets/images/bishop_${promotionTeamType()}.svg`} alt=\"promote bishop\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.KNIGHT)} src={`${process.env.PUBLIC_URL}/assets/images/knight_${promotionTeamType()}.svg`} alt=\"promote knight\"/>\n\t\t\t<img onClick={()=> promotePawn(PieceType.QUEEN)} src={`${process.env.PUBLIC_URL}/assets/images/queen_${promotionTeamType()}.svg`} alt=\"promote queen\"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div className=\"board-layout\">\n\n\t\t\t{/* timer panel */}\n\t\t\t{(online?.status === 'playing') && (\n\t\t\t<div className=\"timer-panel\">\n\t\t\t\t<div className={`timer-block ${currentTurn==='black' ? 'active' : ''}`}>\n\t\t\t\t\t<div className=\"timer-label\">Black</div>\n\t\t\t\t\t<div className=\"timer-value\">{formatTime(blackTimeLeft)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div className={`timer-block ${currentTurn==='white' ? 'active' : ''}`}>\n\t\t\t\t\t<div className=\"timer-label\">White</div>\n\t\t\t\t\t<div className=\"timer-value\">{formatTime(whiteTimeLeft)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t)}\n\n\n\t\t\t<div \n\t\t\t\tonMouseMove={(e)=>movePiece(e)} \n\t\t\t\tonMouseDown={e=> grabPiece(e)} \n\t\t\t\tonMouseUp={(e)=> dropPiece(e)}\n\t\t\t\tid=\"chessboard\"\n\t\t\t\tref={chessboardRef}>\n\t\t\t\t\t{board}\n\t\t\t</div>\n\t\t</div>\n\t\t</>\n\t)\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}